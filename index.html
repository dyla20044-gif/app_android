<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cine HD</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>

    <style>
        /* Contenedor de la nueva pantalla de TV */
        #tv-live-screen {
            padding: 0;
            padding-bottom: 70px; /* Deja espacio para la barra de navegación */
            background-color: #121212; /* Fondo oscuro */
        }

        #tv-player-container {
            width: 100%;
            /* Mantiene el aspecto 16:9, ideal para video en móvil */
            aspect-ratio: 16 / 9; 
            background-color: black;
            position: relative;
        }
        
        #tv-video-player {
            width: 100%;
            height: 100%;
            object-fit: contain; 
        }

        #tv-current-channel-name {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            background-color: rgba(229, 9, 20, 0.8); /* Rojo oscuro semi-transparente */
            color: white;
            padding: 5px 10px;
            font-size: 0.9em;
            font-weight: bold;
            text-align: center;
            box-sizing: border-box;
        }

        #tv-channel-grid {
            display: grid;
            /* Cuadrícula de 2 columnas para móviles, mejor usabilidad */
            grid-template-columns: repeat(2, 1fr); 
            gap: 10px;
            padding: 10px;
        }

        .tv-grid-item {
            background-color: #1E1E1E;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 2px solid transparent; 
        }
        
        .tv-grid-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .tv-grid-item.active {
            border-color: #E50914; /* Borde rojo activo (el color principal de tu app) */
        }

        .tv-grid-item-content {
            padding: 10px;
            text-align: center;
        }

        .tv-grid-item-title {
            font-size: 0.9em;
            font-weight: bold;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .tv-grid-item-info {
            font-size: 0.7em;
            color: #B0B0B0;
        }

        /* Adaptación para tablets (3 columnas) */
        @media (min-width: 600px) {
            #tv-channel-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>

</head>
<body>

    <header class="top-nav">
        <div class="nav-left">
            <span class="logo-text">SALA CINE</span>
        </div>
        <div class="nav-center-icons">
            <a href="https://t.me/+cSG-iHxIneg5YjAx" target="_blank" id="btn-open-community" class="icon-button" aria-label="Chat de Comunidad">
                <i class="fas fa-users"></i>
            </a>
        </div>
        <div class="nav-right">
            <button id="btn-open-search" class="icon-button search-icon-button" aria-label="Abrir búsqueda"><i class="fas fa-search"></i></button>
            <button id="btn-toggle-theme" class="icon-button" aria-label="Tema Dual"><i class="fas fa-moon"></i></button>
            <button id="btn-open-avisos" class="icon-button" aria-label="Notificaciones">
                <i class="fas fa-bell"></i>
                <span id="notification-indicator" class="indicator hidden"></span>
            </button>
        </div>
    </header>

    <div class="search-overlay" id="search-overlay">
        <input type="text" id="search-input" placeholder="Buscar películas...">
        <button id="close-search-button"><i class="fas fa-times"></i></button>
    </div>

    <main id="app-container" style="display:none;">
        <div id="home-screen" class="screen active">
            <section class="hero-banner-carousel">
                <div id="banner-list" class="movie-list horizontal-scroll"></div>
            </section>
            <div id="carousels-container">
                <section class="category-section" id="history-section" style="display:none;">
                    <div class="category-header">
                        <h2>Historial</h2>
                        <a href="#" class="see-more-btn" data-endpoint="history" data-type="movie">Ver más</a>
                    </div>
                    <div id="history-list" class="movie-list horizontal-scroll"></div>
                </section>
                <section class="category-section">
                    <div class="category-header">
                        <h2>Populares</h2>
                        <a href="#" class="see-more-btn" data-endpoint="movie/popular" data-type="movie">Ver más</a>
                    </div>
                    <div id="populares-movies" class="movie-list horizontal-scroll"></div>
                </section>
                
                <section class="category-section">
                    <div class="category-header">
                        <h2>Tendencias</h2>
                        <a href="#" class="see-more-btn" data-endpoint="trending/all/day" data-type="movie">Ver más</a>
                    </div>
                    <div id="tendencias-movies" class="movie-list horizontal-scroll"></div>
                </section>

                 <section class="category-section">
                    <div class="category-header">
                        <h2>Acción y Aventura</h2>
                        <a href="#" class="see-more-btn" data-endpoint="discover/movie?with_genres=28" data-type="movie">Ver más</a>
                    </div>
                    <div id="accion-movies" class="movie-list horizontal-scroll"></div>
                </section>
                
                <section class="category-section">
                    <div class="category-header">
                        <h2>Terror y Misterio</h2>
                        <a href="#" class="see-more-btn" data-endpoint="discover/movie?with_genres=27,9648" data-type="movie">Ver más</a>
                    </div>
                    <div id="terror-movies" class="movie-list horizontal-scroll"></div>
                </section>

                <section class="category-section">
                    <div class="category-header">
                        <h2>Animación</h2>
                        <a href="#" class="see-more-btn" data-endpoint="discover/movie?with_genres=16" data-type="movie">Ver más</a>
                    </div>
                    <div id="animacion-movies" class="movie-list horizontal-scroll"></div>
                </section>

                <section class="category-section">
                    <div class="category-header">
                        <h2>Documentales</h2>
                        <a href="#" class="see-more-btn" data-endpoint="discover/movie?with_genres=99" data-type="movie">Ver más</a>
                    </div>
                    <div id="documentales-movies" class="movie-list horizontal-scroll"></div>
                </section>

                <section class="category-section">
                    <div class="category-header">
                        <h2>Ciencia Ficción</h2>
                        <a href="#" class="see-more-btn" data-endpoint="discover/movie?with-genres=878" data-type="movie">Ver más</a>
                    </div>
                    <div id="scifi-movies" class="movie-list horizontal-scroll"></div>
                </section>

                <section class="category-section">
                    <div class="category-header">
                        <h2>Series Populares</h2>
                        <a href="#" class="see-more-btn" data-endpoint="tv/popular" data-type="tv">Ver más</a>
                    </div>
                    <div id="populares-series" class="movie-list horizontal-scroll"></div>
                </section>
            </div>
        </div>

        <div id="movies-screen" class="screen">
            <div class="screen-header">
                <h2>Películas</h2>
                <button id="genres-button" class="icon-button"><i class="fas fa-ellipsis-v"></i></button>
            </div>
            <div id="search-filters" class="filter-bar">
                <button class="filter-button active" data-filter="all">Todo</button>
                <button class="filter-button" data-filter="movie">Películas</button>
                <button class="filter-button" data-filter="tv">Series</button>
            </div>
            <div id="all-movies-grid" class="movie-grid"></div>
        </div>

        <div id="series-screen" class="screen">
            <div class="screen-header">
                <h2>Series de TV</h2>
                <button id="series-genres-button" class="icon-button"><i class="fas fa-ellipsis-v"></i></button>
            </div>
            <div id="all-series-grid" class="movie-grid"></div>
        </div>

        <div id="tv-live-screen" class="screen">
            <div id="tv-player-container">
                <video id="tv-video-player" controls autoplay playsinline></video>
                <div id="tv-current-channel-name">Cargando canales...</div>
            </div>
            <div id="tv-channel-grid">
                </div>
        </div>
        <div id="profile-screen" class="screen">
            <div id="profile-logged-in" style="display: none;">
                <div class="screen-header">
                    <h2>Mi Perfil</h2>
                    <button id="signout-button" class="icon-button"><i class="fas fa-sign-out-alt"></i></button>
                </div>
                <div class="profile-options">
                    <button id="pro-status-button" class="button profile-button"><i class="fas fa-crown"></i> <span>Activar Cuenta Premium</span></button>
                    <button id="favorites-button" class="button secondary profile-button" data-screen="favorites-screen"><i class="fas fa-heart"></i> <span>Mis Favoritos</span></button>
                    <button id="request-button" class="button secondary profile-button" data-screen="request-screen"><i class="fas fa-plus-circle"></i> <span>Solicitar Película</span></button>
                    <button id="settings-button" class="button secondary profile-button" data-screen="settings-screen"><i class="fas fa-cog"></i> <span>Configuración</span></button>
                </div>
            </div>
            <div id="profile-logged-out" style="display: block;">
                <div class="screen-header">
                    <h2>Mi Perfil</h2>
                    <a href="#" id="profile-login-link" class="text-button">Iniciar sesión</a>
                </div>
                <div class="profile-cta">
                    <h2 class="profile-cta-title">Con Premium tienes más</h2>
                    <div class="premium-benefits">
                        <p><i class="fas fa-check"></i> Series y Películas Premium</p>
                        <p><i class="fas fa-check"></i> Más contenido que cualquier otro streaming</p>
                        <p><i class="fas fa-check"></i> Cancela cuando quieras</p>
                        <p><i class="fas fa-check"></i> Sin anuncios</p>
                    </div>
                    <button class="button profile-cta-button" id="create-account-button">Crea tu cuenta Premium</button>
                </div>
                <div class="profile-footer-links">
                    <a href="#" id="profile-my-list" class="profile-link">Mi lista</a>
                    <a href="#" id="profile-privacy" class="profile-link">Política de privacidad</a>
                    <a href="#" id="profile-terms" class="profile-link">Términos de uso</a>
                    <a href="#" id="profile-subscription" class="profile-link">Condiciones de Suscripción</a>
                    <a href="#" id="profile-help-center" class="profile-link">Centro de ayuda</a>
                </div>
            </div>
        </div>
        <div id="favorites-screen" class="screen">
            <div class="screen-header">
                <h2>Mis Favoritos</h2>
            </div>
            <div id="favorites-grid" class="movie-grid"></div>
        </div>

        <div id="request-screen" class="screen">
            <div class="screen-header">
                <h2>Solicitar Película</h2>
            </div>
            <div id="request-message" class="request-message-box"></div>
            <div class="request-form">
                <input type="text" id="movie-request-input" placeholder="Nombre de la película o serie...">
                <button id="submit-request-button" class="button">Enviar Solicitud</button>
            </div>
        </div>

        <div id="privacy-screen" class="screen">
            <div class="screen-header">
                <h2>Política de Privacidad</h2>
            </div>
            <div class="policy-content">
                <p>En Sala Cine, la seguridad y privacidad de tus datos es nuestra máxima prioridad. Recopilamos la información mínima necesaria para ofrecerte un servicio personalizado y proteger tu cuenta. Toda tu información está resguardada con los más altos estándares de seguridad y puedes cancelar tu suscripción en cualquier momento.</p>
                <p>Nuestra plataforma se actualiza diariamente con nuevas funciones y medidas de seguridad para garantizar una experiencia óptima y segura para todos nuestros usuarios.</p>
            </div>
        </div>

        <div id="terms-screen" class="screen">
            <div class="screen-header">
                <h2>Términos de Uso</h2>
            </div>
            <div class="policy-content">
                <p>Bienvenido a Sala Cine. Al usar nuestros servicios, aceptas cumplir con los siguientes términos de uso. Sala Cine te ofrece una plataforma de streaming de contenido bajo demanda, incluyendo películas y series. El acceso a contenido Premium requiere una suscripción de pago. Nos reservamos el derecho de modificar estos términos en cualquier momento.</p>
                <p>No se permite el uso no autorizado de nuestro contenido, incluyendo la descarga, distribución o copia sin permiso. El incumplimiento de estos términos puede resultar en la suspensión de tu cuenta.</p>
            </div>
        </div>

        <div id="help-screen" class="screen">
            <div class="screen-header">
                <h2>Centro de Ayuda</h2>
            </div>
            <div class="help-content">
                <div class="help-options">
                    <button class="help-option-button">Error en reproducción de video</button>
                    <button class="help-option-button">Problemas con el inicio de sesión</button>
                    <button class="help-option-button">Problemas con la app</button>
                    <button class="help-option-button">Cambiar mi plan Premium</button>
                </div>
                <a href="https://t.me/tu-usuario-de-telegram" target="_blank" class="button contact-button">Contáctate con nosotros</a>
            </div>
        </div>
        
        <div id="settings-screen" class="screen">
            <div class="screen-header">
                <h2>Configuración</h2>
            </div>
            <div class="settings-content">
                <p>Aquí puedes ajustar las configuraciones de tu cuenta.</p>
            </div>
        </div>


        <div id="details-screen" class="screen">
            <div class="details-header-section">
                <div id="details-poster-top">
                    <div id="embedded-player-container" style="display: none;"></div>
                    <div class="poster-overlay">
                        <div id="details-play-button-container">
                            <button id="details-play-button" class="play-button"><i class="fas fa-play"></i></button>
                            <button id="request-movie-button" class="play-button" style="display: none;"><i class="fas fa-paper-plane"></i> Pedir ahora</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="details-content-scrollable">
                <div class="details-info-section">
                    <div id="details-request-message" class="request-message-box"></div>
                    <div class="movie-header">
                        <h2 id="details-title"></h2>
                        <div class="movie-actions">
                            <i id="share-button" class="fas fa-share-alt"></i>
                            <i id="favorite-button" class="far fa-heart"></i>
                        </div>
                    </div>
                    <div class="movie-metadata">
                        <div class="movie-metrics">
                            <span id="view-count-display"><i class="fas fa-eye"></i> 0 Vistas</span>
                            <span id="like-count-display-text"><i class="fas fa-heart"></i> 0 Me Gusta</span>
                        </div>
                        <div class="movie-attributes">
                            <span id="details-year"></span>
                            <span id="details-genres"></span>
                        </div>
                    </div>
                    <p id="details-sinopsis"></p>
                    <button id="read-more-button" class="text-button">Ver más</button>
                    <div id="movie-cast-info" class="movie-cast">
                        <p>Director: <span id="director-name"></span></p>
                        <p>Actores: <span id="actors-list"></span></p>
                    </div>

                    <div id="seasons-container" class="episode-select-container" style="display:none;"></div>
                    <div id="episodes-container"></div>
                    <div class="tabs-container">
                        <div class="tabs-header" id="details-tabs-header">
                            <button class="tab-button active" data-tab="related-content-pane">Similares</button>
                            <button class="tab-button" data-tab="comments-content-pane">Comentarios</button>
                        </div>
                        
                        <div class="tabs-content" id="details-tabs-content">
                            <div class="tab-pane active" id="related-content-pane">
                                <section class="related-section">
                                    <div id="related-movies" class="movie-list horizontal-scroll"></div>
                                </section>
                            </div>
                            
                            <div class="tab-pane" id="comments-content-pane">
                                <div class="comments-container">
                                    <h3>Comentarios</h3>
                                    <div class="comment-input-area">
                                        <input type="text" id="comment-input" placeholder="Escribe un comentario...">
                                        <button id="btn-post-comment" class="button primary"><i class="fas fa-paper-plane"></i></button>
                                    </div>
                                    <div id="comments-feed" class="comments-feed">
                                        <p id="no-comments-message" style="color:#888; display:none;">Sé el primero en comentar.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="auth-screen" class="screen full-screen-auth">
            <header class="auth-header">
                <a href="#" class="back-button" id="auth-back-button"><i class="fas fa-arrow-left"></i></a>
                <div class="auth-header-title">Sala Cine</div>
                <a href="#" class="login-link" id="auth-login-link">Iniciar sesión</a>
            </header>
            <div class="auth-content-container">
                <div id="login-form" class="auth-form active-form">
                    <h2 class="auth-title">Inicia sesión</h2>
                    <div id="login-message" class="auth-message-box"></div>
                    <input type="email" id="login-email" placeholder="Correo electrónico">
                    <div class="password-container">
                        <input type="password" id="login-password" placeholder="Contraseña">
                        <i class="fas fa-eye password-toggle"></i>
                    </div>
                    <button class="button auth-button primary" id="login-button">Iniciar sesión</button>
                    <p class="auth-separator">o</p>
                    <p class="switch-form-text">¿No tienes cuenta? <a href="#" id="show-signup-link">Crea una</a></p>
                    <a href="#" class="forgot-password-link">¿Olvidaste tu contraseña?</a>
                </div>
                <div id="signup-form" class="auth-form">
                    <h2 class="auth-title">Crea tu cuenta</h2>
                    <div id="signup-message" class="auth-message-box"></div>
                    <input type="email" id="signup-email" placeholder="ejemplo@email.com">
                    <div class="password-container">
                        <input type="password" id="signup-password" placeholder="Contraseña">
                        <i class="fas fa-eye password-toggle"></i>
                    </div>
                    <div class="terms-checkbox">
                        <input type="checkbox" id="terms-checkbox">
                        <label for="terms-checkbox" class="terms-label">Acepto los Términos de Uso de Sala Cine y reconozco que mi información personal será utilizada conforme al Aviso de Privacidad de Sala Cine.</label>
                    </div>
                    <button class="button auth-button primary" id="signup-button">Comenzar</button>
                    <p class="auth-separator">o</p>
                    <p class="switch-form-text">¿Ya tienes cuenta? <a href="#" id="show-login-link">Inicia sesión</a></p>
                </div>
            </div>
        </div>
    </main>

    <nav class="bottom-nav">
        <a href="#" class="nav-item active" data-screen="home-screen">
            <i class="fas fa-home"></i>
            <span>Inicio</span>
        </a>
        <a href="#" class="nav-item" data-screen="movies-screen">
            <i class="fas fa-film"></i>
            <span>Películas</span>
        </a>
        <a href="#" class="nav-item" data-screen="series-screen">
            <i class="fas fa-tv"></i>
            <span>Series</span>
        </a>
        <a href="#" class="nav-item" data-screen="tv-live-screen">
            <i class="fas fa-satellite-dish"></i>
            <span>TV</span>
        </a>
        <a href="#" class="nav-item" data-screen="profile-screen">
            <i class="fas fa-user"></i>
            <span>Perfil</span>
        </a>
    </nav>

    <div id="video-modal" class="modal">
        <div class="modal-content video-content">
            <span class="close-button">&times;</span>
            <video id="video-player" controls></video>
        </div>
    </div>
    
    <div id="premium-info-modal" class="modal-from-bottom">
        <div class="modal-content">
            <span class="close-button" id="premium-info-close">&times;</span>
            <h2 class="premium-info-title">Con Premium tienes más</h2>
            <div class="premium-benefits">
                <p><i class="fas fa-check"></i> Series y Películas Premium</p>
                <p><i class="fas fa-check"></i> Más novelas que cualquier otro streaming</p>
                <p><i class="fas fa-check"></i> Cancela cuando quieras</p>
                <p><i class="fas fa-check"></i> Sin anuncios</p>
            </div>
            <button class="button premium-cta-button" id="premium-info-cta">Empezar ya</button>
            <p class="premium-info-login">Ya tengo plan Premium, <a href="#" id="premium-info-login-link">iniciar sesión</a>.</p>
        </div>
    </div>

    <div id="payment-modal" class="modal">
        <div class="modal-content payment-content">
            <span class="close-button" id="payment-close">&times;</span>
            <h2>Activar Cuenta Premium</h2>
            <p>Disfruta de nuestra selección Premium sin anuncios y con acceso anticipado a nuevas películas y series. Protegemos tus datos con los más altos estándares de seguridad, al igual que plataformas como Netflix y Disney Plus.</p>
            <div class="plans-container">
                <div class="plan-card">
                    <h3>Plan Mensual</h3>
                    <p>1 mes por $1.99</p>
                    <button class="button buy-button" data-plan="monthly">Comprar</button>
                </div>
                <div class="plan-card">
                    <h3>Plan Anual</h3>
                    <p>1 año por $19.99</p>
                    <button class="button buy-button" data-plan="annual">Comprar</button>
                </div>
            </div>
            <p class="legal-text">© Cine. Todos los derechos reservados. Su suscripción se renueva automáticamente. Puede cancelar en cualquier momento.</p>
        </div>
    </div>
    
    <div id="free-ad-modal" class="modal-from-bottom">
        <div class="modal-content">
            <span class="close-button free-modal-close-button">&times;</span>
            <h2 class="modal-title-ad">Versión Gratis con Publicidad</h2>
            <p class="modal-text-ad">Estás a punto de ver la versión gratis de esta película. calidad (720p).Tendrás un poco de publicidad durante la reproducción.</p>
            <div class="modal-buttons-ad">
                <button id="ver-gratis-button" class="button">Ver Gratis 720p</button>
                <button id="ver-pro-button" class="button secondary">Ver PRO HD (sin anuncios 1080p)</button>
            </div>
            <p class="modal-small-text">¡El plan PRO es muy accesible!</p>
        </div>
    </div>

    <div id="pro-restriction-modal" class="modal-from-bottom">
        <div class="modal-content">
            <span class="close-button free-modal-close-button">&times;</span>
            <h2 class="modal-title-ad">¡Esta película solo está disponible en la versión PRO!</h2>
            <p class="modal-small-text" id="pro-modal-text">Los planes están desde $1,99 mensual.</p>
            <div class="modal-buttons-ad">
                <button id="pro-modal-cta" class="button red">Ver ahora PRO</button>
            </div>
        </div>
    </div>

    <div id="user-notifications-modal" class="modal-from-bottom">
        <div class="modal-content notifications-content">
            <div class="modal-header">
                <h2 class="modal-title">Notificaciones</h2>
                <span class="close-button" id="notifications-close">&times;</span>
            </div>
            
            <div id="notifications-list" class="notifications-list">
                <p id="empty-notifications-message" class="empty-message hidden">Aún no tienes notificaciones.</p>
            </div>

            <button id="btn-clear-all-notifications" class="button secondary full-width mt-10 hidden">Borrar todas</button>
        </div>
    </div>

    <div id="add-event-modal" class="modal-from-bottom">
        <div class="modal-content auth-content">
            <span class="close-button" id="add-event-close">&times;</span>
            <h2 class="auth-title">Agregar Evento</h2>
            <div id="event-message" class="auth-message-box"></div> 
            <form id="add-event-form">
                <input type="url" id="event-image-link" placeholder="Enlace de la fotografía (URL)" required>
                <textarea id="event-description" placeholder="Descripción del evento" required rows="4"></textarea>
                <button type="submit" id="btn-submit-event" class="button primary">Guardar Evento</button>
            </form>
        </div>
    </div>

    <div id="admin-avisos-modal" class="modal-from-bottom">
        <div class="modal-content admin-avisos-content">
            <span class="close-button" id="avisos-close">&times;</span>
            <h2 class="modal-title-ad">Publicar Contenido (Admin)</h2>
            <p class="modal-text-ad">Ingrese el link del reproductor y elija la acción:</p>
            <input type="text" id="admin-embed-input" placeholder="Enlace del Reproductor (ej: link-pelicula-1)">
            <div class="modal-buttons-ad">
                <button id="btn-save-app" class="button secondary">Guardar solo en la app</button>
                <button id="btn-save-publish-channel" class="button">Guardar y publicar en el canal</button>
                <button id="btn-save-notify-app-new" class="button red">Guardar en la app y notificar</button>
            </div>
            <p class="modal-small-text">Esta acción es solo visible para usuarios con rol de administrador.</p>
        </div>
    </div>

    <div class="footer-text">©Cine. Todos los derechos reservados.</div>
    <div id="loader"><div class="loader-spinner"></div><p>Cargando...</p></div>

    <script>
        const tv_channels = [
            { name: "8NTV", url: "https://60417ddeaf0d9.streamlock.net/ntv/videontv/playlist.m3u8", info: "1080p" },
            { name: "15TV", url: "https://cdn.fastocloud.com/leonel.m3u8", info: "SD" },
            { name: "15tv Sabinas", url: "https://hls.gvstream.live/telesistemas/15tv.stream/playlist.m3u8", info: "360p" },
            { name: "ADN 40", url: "https://mdstrm.com/live-stream-playlist/60b578b060947317de7b57ac.m3u8", info: "720p" },
            { name: "Afizzionados", url: "https://linear-348.frequency.stream/mt/studio/348/hls/master/playlist.m3u8", info: "576p" },
            { name: "Alcance TV", url: "https://5bf8041cb3fed.streamlock.net/AlcanceTV/AlcanceTV/playlist.m3u8", info: "720p" },
            { name: "Antena TV", url: "https://5ca9af4645e15.streamlock.net/grd/videogrd/playlist.m3u8", info: "1080p" },
            { name: "Azteca Internacional", url: "https://azt-mun.otteravision.com/azt/mun/mun.m3u8", info: "1080p" },
            { name: "B15", url: "https://60ed5b6d0df78.streamlock.net:1936/envio2/envio2/playlist.m3u8", info: "1080p" },
            { name: "Bandamax", url: "https://linear-400.frequency.stream/mt/studio/400/hls/master/playlist.m3u8", info: "SD" },
            { name: "bitMe", url: "https://linear-401.frequency.stream/mt/studio/401/hls/master/playlist.m3u8", info: "576p" },
            { name: "Canal 5", url: "http://104.238.205.28:8989/278329_.m3u8", info: "720p" },
            { name: "Canal 6 CDMX", url: "https://stitcher-ipv4.pluto.tv/v1/stitch/embed/hls/channel/652e91fd6208700008dcaf7blivestitch/master.m3u8", info: "SD" },
            { name: "Canal 10 Chiapas", url: "https://5ca9af4645e15.streamlock.net/chiapas/videochiapas/playlist.m3u8", info: "720p" },
            { name: "Canal Catorce", url: "https://s5.mexside.net:1936/canal14/canal14/playlist.m3u8", info: "720p" },
            { name: "Canal del Congreso 45.3", url: "https://edgeplay.canaldelcongreso.gob.mx/live_hd1/smil:canal-hd1.smil/playlist.m3u8", info: "HD" },
            { name: "Capital 21", url: "https://streamingc21.cdmx.gob.mx/capital21/stream.m3u8", info: "1080p" },
            { name: "CorTV", url: "https://stream.oursnetworktv.com/latin/encoder29/playlist.m3u8", info: "800p" },
            { name: "De Película", url: "https://linear-354.frequency.stream/mt/studio/354/hls/master/playlist.m3u8", info: "576p" },
            { name: "Foro TV", url: "https://channel02-notusa.akamaized.net/hls/live/2023914/event01/index.m3u8", info: "1080p" },
            { name: "Golden Plus", url: "https://linear-410.frequency.stream/dist/vix/410/hls/master/playlist.m3u8", info: "576p" },
            { name: "Justicia TV", url: "https://live-scjn.ovp-vivaro.digital/ovp-origin/638a22b47746d/playlist.m3u8", info: "720p" },
            { name: "Las Estrellas", url: "https://channel01-onlymex.akamaized.net/hls/live/2022749/event01/index.m3u8", info: "1080p" },
            { name: "Milenio Television", url: "https://stitcher-ipv4.pluto.tv/v1/stitch/embed/hls/channel/652e922db4b047000825f975livestitch/master.m3u8", info: "SD" },
            { name: "NMás", url: "https://channel07-notusa.akamaized.net/hls/live/2036971/event01/index.m3u8", info: "1080p" },
            { name: "Once México", url: "https://vivo.canaloncelive.tv/alivepkgr3/ngrp:cepro_all/playlist.m3u8", info: "1080p" },
            { name: "PSN", url: "https://srspsn.live/live/livestream.m3u8", info: "SD" },
            { name: "RCG TV", url: "https://video1.getstreamhosting.com:1936/8172/8172/playlist.m3u8", info: "1080p" },
            { name: "Sistema Michoacano", url: "https://60ed5b6d0df78.streamlock.net:1936/enlinea/enlinea/playlist.m3u8", info: "1080p" },
            { name: "Telehit", url: "http://45.175.139.194:8000/play/62", info: "1080p" },
            { name: "TUDN México", url: "http://190.61.102.67:2000/play/a08j/index.m3u8", info: "540p" },
            { name: "TV BUAP", url: "https://tvenvivo.buap.mx/livestream/stream.m3u8", info: "1080p" },
            { name: "UDG TV Canal 44", url: "https://d1sx1b16qowo88.cloudfront.net/out/v1/c278fcc434d1437eb31ff105c6b4a538/index.m3u8", info: "720p" },
            { name: "ZAZ", url: "https://cloud.fastchannel.es/mic/manifiest/hls/zaztv/zaztv.m3u8", info: "SD" }
        ];

        const tv_video = document.getElementById('tv-video-player');
        const tv_channel_grid = document.getElementById('tv-channel-grid');
        const tv_current_name = document.getElementById('tv-current-channel-name');
        let tv_currentItem = null;
        let hls_instance = null;

        function tv_loadChannel(item, index) {
            const channel = tv_channels[index];
            const url = channel.url;
            const name = channel.name;
            
            tv_current_name.textContent = `Reproduciendo: ${name}`;
            
            // 1. Manejo de la clase activa (borde rojo)
            if (tv_currentItem) {
                tv_currentItem.classList.remove('active');
            }
            item.classList.add('active');
            tv_currentItem = item;

            // 2. Limpiar reproductor y crear nueva instancia HLS
            if (hls_instance) {
                hls_instance.destroy();
                hls_instance = null; // Reiniciar
            }
            
            // 3. Cargar y reproducir el stream
            if (Hls.isSupported() && (url.endsWith('.m3u8') || url.includes('.m3u8'))) {
                hls_instance = new Hls();
                hls_instance.attachMedia(tv_video);
                hls_instance.on(Hls.Events.MEDIA_ATTACHED, function () {
                    hls_instance.loadSource(url);
                    hls_instance.on(Hls.Events.MANIFEST_PARSED, function () {
                        tv_video.play().catch(e => console.log("Error de auto-play:", e));
                    });
                    hls_instance.on(Hls.Events.ERROR, function (event, data) {
                        if (data.fatal) {
                            tv_current_name.textContent = `❌ ERROR: ${name} (Stream caído o no soportado)`;
                            hls_instance.destroy();
                        }
                    });
                });
            } else if (tv_video.canPlayType('application/vnd.apple.mpegurl')) {
                // Soporte nativo (iOS/Safari)
                tv_video.src = url;
                tv_video.addEventListener('loadedmetadata', function () { tv_video.play().catch(e => console.log("Error de auto-play nativo:", e)); });
            } else {
                // Intento final para otros formatos o navegadores sin HLS
                tv_video.src = url;
                tv_video.play().catch(e => {
                    tv_current_name.textContent = `⚠️ ADVERTENCIA: Error al iniciar ${name} (URL no soportada)`;
                });
            }
        }
        
        function tv_renderChannelGrid() {
            let htmlContent = '';
            tv_channels.forEach((channel, index) => {
                htmlContent += `
                    <div class="tv-grid-item" data-index="${index}" onclick="tv_loadChannel(this, ${index})">
                        <div class="tv-grid-item-content">
                            <div class="tv-grid-item-title">${channel.name}</div>
                            <div class="tv-grid-item-info">${channel.info} | En vivo</div>
                        </div>
                    </div>
                `;
            });
            tv_channel_grid.innerHTML = htmlContent;
        }
        
        // Función de control de pestañas (Adaptada de tu lógica data-screen)
        function handleScreenNavigation(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.style.display = 'none';
                screen.classList.remove('active');
            });

            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.style.display = 'block';
                targetScreen.classList.add('active');
            }

            // Lógica específica para la TV
            if (screenId === 'tv-live-screen') {
                if (tv_channel_grid.children.length === 0) {
                    tv_renderChannelGrid();
                    const firstChannel = document.querySelector('.tv-grid-item');
                    if (firstChannel) {
                        tv_loadChannel(firstChannel, 0);
                    }
                }
            }
        }
        
        // Sobrescribir el listener de la navegación para incluir la lógica de la TV
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.bottom-nav .nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // 1. Limpiar el estado activo de la navegación
                    document.querySelectorAll('.bottom-nav .nav-item').forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');

                    // 2. Activar la nueva pantalla
                    const screenId = this.getAttribute('data-screen');
                    handleScreenNavigation(screenId);
                });
            });

            // Asegurar que al inicio se muestre la pantalla activa (o 'home-screen' por defecto)
            const activeNav = document.querySelector('.bottom-nav .nav-item.active');
            if (activeNav) {
                const initialScreenId = activeNav.getAttribute('data-screen');
                handleScreenNavigation(initialScreenId);
            } else {
                 // Si no hay activa, intenta mostrar la de inicio o la que tu app define por defecto.
                 handleScreenNavigation('home-screen'); 
            }
        });
    </script>
    <script type="module" src="script.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</body>
</html>
